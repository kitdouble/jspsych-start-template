<!DOCTYPE html>
<html>
<head>
  <title>USYD Metacognition</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">

  <!-- Load jsPsych and jquery-->
  <script src="https://unpkg.com/jspsych@7.3.3"></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.2/js/foundation.min.js'></script>
  <link href="https://unpkg.com/jspsych@7.2.3/css/jspsych.css" rel="stylesheet" type="text/css" />


  <!-- Load jsPsych plugins-->
  <script src="https://unpkg.com/@jspsych/plugin-instructions@1.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-external-html@1.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-preload@1.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-call-function"></script>
  <script src="https://unpkg.com/@jspsych/plugin-fullscreen@1.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-html-form@1.0.0"></script>
  <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe"></script>

  <!-- Load the global environment-->
  <script src="global-env.js"></script>
  <script src="info_sheets.js"></script>

  <!-- Load custom plugins from directory-->




</head>
<body></body>
<script>



//////////////////////////////////
//         Gloabl Settings      //
//////////////////////////////////

// Initalise jsPsych
  const jsPsych = initJsPsych({
    on_finish: function(data) {
     if(jsPsych.data.get().select('accuracy').mean() < 0.10){window.location = attention_redirect_link} else {window.location = redirect_link}
   }
})


// Settings


// Capture any url paramaters
 const PROLIFIC_PID = jsPsych.data.getURLVariable('PROLIFIC_PID');
 const SONA_PID = jsPsych.data.getURLVariable('id');

 jsPsych.data.addProperties({participant_id: PROLIFIC_PID});




// Redirect based on SONA vs Prolific

    // SONA
 if(typeof SONA_PID != 'undefined'){

  jsPsych.data.addProperties({participant_id: SONA_PID});
  jsPsych.data.addProperties({Source: "SONA"});
  console.log("sona")
  redirect_link = "https://sydneypsych.sona-systems.com/webstudy_credit.aspx?experiment_id=2953&credit_token=328b91e0da274cd187bf3a85b0ea3d08&survey_code=" + SONA_PID + "&id=" + SONA_PID;
  attention_redirect_link = "https://sydney.au1.qualtrics.com/jfe/form/SV_3h2qh8pBAnv00QK?SONA_PID=" + SONA_PID + "accuracy=" + jsPsych.data.get().select('accuracy').mean(); // A seperate link for those who fail the attention check
  

}

    // PROLIFIC
if(typeof SONA_PID === 'undefined'){

  jsPsych.data.addProperties({participant_id: PROLIFIC_PID});
  jsPsych.data.addProperties({Source: "Prolific"});
  console.log("prolific")
  redirect_link ="https://app.prolific.com/submissions/complete?cc=XXXXXXX"
  attention_redirect_link ="https://app.prolific.co/submissions/complete?cc=XXXXXXX" // A seperate link for those who fail the attention check
}



  // Save to OSF
const subject_id = jsPsych.randomization.randomID(10);
const filename = `${subject_id}.csv`;
const DataPipe_ID = "chMUqOOe9hhf" // The DataPipe ID for where the data should be stored



const save_data = {
  type: jsPsychPipe,
  action: "save",
  experiment_id: DataPipe_ID,
  filename: filename,
  data_string: ()=>jsPsych.data.get().csv()
};


//////////////////////////////////





 // Stimuli








  // Trials

const hello_trial_C1 = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: 'Hello world! You are in Condition 1'
}


const hello_trial_C2 = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: 'Hello world! You are in Condition 2'
}

var debug = {
  type: jsPsychSurveyText,
  questions: [
    {prompt: 'Did you experience any issues while completing this study?', rows: 5}
    ]
}



  // Blocks










// Set Condition


condition_1_timeline = [hello_trial_C1, debug, save_data];
condition_2_timeline = [hello_trial_C2, debug, save_data];


async function createExperiment(){
  const condition = await jsPsychPipe.getCondition(DataPipe_ID);
  jsPsych.data.addProperties({condition: condition});
  if(condition == 0) { timeline = condition_1_timeline; }
  if(condition == 1) { timeline = condition_2_timeline; }
  jsPsych.run(timeline);
}


createExperiment();








</script>
</html>
