<!DOCTYPE html>
<html>
  <head>
    <title>USYD Cognitive Flexibility</title>

      <!-- Load jsPsych and jquery-->
        <script src="https://unpkg.com/jspsych@7.2.1"></script>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.2/js/foundation.min.js'></script>
        <link href="https://unpkg.com/jspsych@7.2.3/css/jspsych.css" rel="stylesheet" type="text/css" />

      <!-- Load jsPsych plugins-->
        <script src="https://unpkg.com/@jspsych/plugin-instructions@1.0.0"></script>
        <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.0.0"></script>
        <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.0.0"></script>
        <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.0.0"></script>
        <script src="https://unpkg.com/@jspsych/plugin-external-html@1.0.0"></script>
        <script src="https://unpkg.com/@jspsych/plugin-preload@1.0.0"></script>
        <script src="https://unpkg.com/@jspsych/plugin-fullscreen@1.0.0"></script>
        <script src="https://unpkg.com/@jspsych/plugin-survey-html-form@1.0.0"></script>

        <!-- Load custom plugins from directory-->

  </head>
  <body></body>
  <script>

  // Initalise jsPsych
  const jsPsych = initJsPsych({
    on_finish: function(data) {
         window.location = "https://app.prolific.co/submissions/complete?cc=XXXXXXX"
   },
   on_data_update: function(data) {
      //data.totalTime = jsPsych.getTotalTime();
      //data.Progress = Math.round(100*((jsPsych.getProgress().current_trial_global + 1)/jsPsych.getProgress().total_trials));
      //if(typeof participant_id != "undefined"){saveData(participant_id + '.csv', experimentname, jsPsych.data.get().csv());};
  }
 });

  // Set global variables
  const user = 'kit';
  const experimentname = "EXP001";

  // Capture any url paramaters
  var PROLIFIC_PID = jsPsych.data.getURLVariable('PROLIFIC_PID');

  // Preamble
  var welcome = {
      type: jsPsychSurveyText,
      questions: [{prompt: "Please enter your Prolific ID", name: 'prolificID', required:true}],
      preamble: "<font size = '15' color='#002080'><b>Welcome to the experiment!</b></font><br><br>",
      button_label: "Begin",
      on_finish: function(data){
        participant_id = data.response.prolificID;
        jsPsych.data.addProperties({participant_id: participant_id});
        if(PROLIFIC_PID != undefined){jsPsych.data.addProperties({PROLIFIC_PID: PROLIFIC_PID});};
      }
    };

  var demographics = {
      type: jsPsychSurveyHtmlForm,
      preamble: "<font size = '15' color='#002080'>Basic Information</font>",
      html: '<div style = "text-align: left"><br><p><b> Age: </b><br><input name="age" type="number" min ="18" max = "100" style = "width: 8em;"required></p>' +
      '<p><b>Sex:</b></p><div><input type="radio" id="male" name="sex" value="male"unchecked><label for="male">Male</label></div><div><input type="radio" id="female" name="sex" value="female"><label for="female">Female</label></div><div><input type="radio" id="other" name="sex" value="other"><label for="other">Non binary/prefer not to say</label></div>' +
      '<p><b>Do you speak english fluently?:</b></p><div><input type="radio" id="yes" name="english" value="yes"unchecked><label for="yes">Yes</label></div><div><input type="radio" id="no" name="english" value="no"><label for="no">No</label></p></div><div></div>',
      on_load: function(){
            document.querySelector('#jspsych-survey-html-form-next').disabled = true;
              $('input[type="radio"]').on("click", function(e) {
                    if($("input[name=age]" ).val() == '' || $("input[type=radio][name=sex]:checked" ).val() === undefined || $( "input[type=radio][name=english]:checked" ).val() === undefined ){return} else {
                    document.querySelector('#jspsych-survey-html-form-next').disabled = false;
                      }
                  })
                }
    };

  // Instructions

  // Stimuli
  const hello_trial = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: 'Hello world!'
  }

  // Save screen
  save_screen = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: "Saving...Please wait!",
    choices: "NO_KEYS",
    trial_duration: 6000,
    on_load: function(data){
      saveData(participant_id + '.csv', experimentname, jsPsych.data.get().csv());
    }
  }


  // Trials

  // Blocks

  // Run the timeline
  jsPsych.run([welcome, demographics, hello_trial, save_screen]);

  // Save
  function saveData(filename, experiment, filedata){
        var filename = '../users/'+user+'/' + experiment + '/Data/' + filename;
        var dir_name = '../users/'+user+'/' + experiment + '/Data/';
         $.ajax({
            type:'post',
            cache: false,
            url: 'https://cogflex.com.au/jspsych/jsPsych.php',
            data: {filename: filename, filedata: filedata, dir_name: dir_name}
         });
      }

  </script>
</html>
